<?xml version="1.0" encoding="utf-8"?>
<project name="OmeroCpp" default="install" basedir=".">

    <dirname property="up-two"        file="${basedir}"/>
    <dirname property="up-one"        file="${up-two}"/>
    <property name="import.dir"       value="${up-one}/antlib/resources"/>
    <property name="copy.dir"         value="target/"/>
    <property name="env.J"            value="1"/>

    <import file="${import.dir}/global.xml"/>
    <import file="../common.xml"/>

    <target name="tools-init" unless="env.NOMAKE">
        <get-source todir="${copy.dir}">
            <fileset dir="../../blitz/generated" includes="**/*.h,**/*.cpp">
                <present present="srconly" targetdir="src"/>
            </fileset>
        </get-source>
    </target>

    <target name="build">
        <scons_py>
            <arg value="-j"/>
            <arg value="${env.J}"/>
        </scons_py>
    </target>

    <target name="tools-build" depends="tools-init,build" description="Use scons to build the libraries" unless="env.NOMAKE"/>

    <target name="tools-dist" depends="tools-build" description="Copies files into tools/target" unless="env.NOMAKE">
        <scons_py>
            <arg value="install"/>
        </scons_py>
        <!-- Using ant to copy since scons tends to flatten the Globs() for copy -->
        <copy todir="../target/include">
            <fileset dir="src"    includes="**/*.h"/>
            <fileset dir="target" includes="**/*.h"/>
        </copy>
    </target>

   <target name="tools-clean">
        <delete dir="${copy.dir}"/>
    </target>

    <!-- Temporary: this will be moved to scons.xml -->
    <target name="findbugs">
        <echo>Not yet implemented</echo>
    </target>
</project>
